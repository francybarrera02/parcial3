extends layout

block content
  .pacientes-container

    h1.text-center Lista de Pacientes

    form(
      method='GET',
      action='/pacientes',
      style='margin-bottom: 20px; text-align: right;'
    )
      input(
        type='text',
        name='search',
        placeholder='Buscar paciente...',
        value= search || '',
        style='padding: 8px 12px; border: 1px solid #ccc; border-radius: 4px; width: 200px;'
      )
      button(
        type='submit',
        style='margin-left: 8px; padding: 8px 12px; background: #6c9eff; color: white; border: none; border-radius: 4px; cursor: pointer;'
      ) ðŸ”
      if search
        a(
          href='/pacientes',
          style='margin-left: 10px; color: #dc3545; font-weight: bold; text-decoration: none;'
        ) Limpiar

    if pacientes.length
      table.pacientes-table(style='width: 100%; border-collapse: collapse; margin-bottom: 30px;')
        thead
          tr
            th(style='background-color: #6c9eff; color: white; padding: 12px 15px; text-align: left;') Nombre
            th(style='background-color: #6c9eff; color: white; padding: 12px 15px; text-align: left;') CÃ©dula
            th(style='background-color: #6c9eff; color: white; padding: 12px 15px; text-align: left;') TelÃ©fono
            th(style='background-color: #6c9eff; color: white; padding: 12px 15px; text-align: left;') DirecciÃ³n
            th(style='background-color: #6c9eff; color: white; padding: 12px 15px; text-align: left;') Acciones
        tbody
          each paciente, idx in pacientes
            tr(style=( idx % 2 === 0 ? 'background-color: #f9f9f9;' : '' ))
              td(style='padding: 12px 15px;')= paciente.nombre
              td(style='padding: 12px 15px;')= paciente.cedula
              td(style='padding: 12px 15px;')= paciente.telefono
              td(style='padding: 12px 15px;')= paciente.direccion
              td(style='padding: 12px 15px;')
                
                a(
                  href=`/historiales/${paciente.id}`,
                  title='Ver Historial',
                  style='margin-right: 12px; color: #007bff; text-decoration: none; font-size: 18px;'
                ) ðŸ“–

               
                a(
                  href=`/pacientes?search=${search || ''}&page=${currentPage || 1}&edit=${paciente.id}`,
                  title='Editar',
                  style='margin-right: 12px; color: #28a745; text-decoration: none; font-size: 18px;'
                ) âœï¸

                
                a(
                  href=`/pacientes/eliminar-paciente/${paciente.id}`,
                  title='Eliminar',
                  style='color: #dc3545; text-decoration: none; font-size: 18px;',
                  onclick="return confirm('Â¿Seguro que deseas eliminar a este paciente?');"
                ) ðŸ—‘ï¸

      if totalPages > 1
        .pagination(style='margin-top: 20px; text-align: center;')
          if currentPage > 1
            a(
              href=`/pacientes?search=${search || ''}&page=${currentPage - 1}`,
              style='padding: 6px 12px; margin: 0 4px; background-color: #e8f0fe; border-radius: 8px; color: #004080; text-decoration: none;'
            ) Â« Anterior
          else
            span(style='padding: 6px 12px; margin: 0 4px; background-color: #f0f0f0; color: #999; border-radius: 8px; cursor: default;') Â« Anterior

          - for (let num = 1; num <= totalPages; num++)
            if num === currentPage
              span(style='padding: 6px 12px; margin: 0 4px; background-color: #6c9eff; color: white; border-radius: 8px;')= num
            else
              a(
                href=`/pacientes?search=${search || ''}&page=${num}`,
                style='padding: 6px 12px; margin: 0 4px; background-color: #e8f0fe; border-radius: 8px; color: #004080; text-decoration: none;'
              )= num

          if currentPage < totalPages
            a(
              href=`/pacientes?search=${search || ''}&page=${currentPage + 1}`,
              style='padding: 6px 12px; margin: 0 4px; background-color: #e8f0fe; border-radius: 8px; color: #004080; text-decoration: none;'
            ) Siguiente Â»
          else
            span(style='padding: 6px 12px; margin: 0 4px; background-color: #f0f0f0; color: #999; border-radius: 8px; cursor: default;') Siguiente Â»

    else
      p.text-center.text-muted No hay pacientes registrados.

    if pacienteEdit
      h2.text-center.mt-5 Editar Paciente

      //- â€œCancelar ediciÃ³nâ€ (SIEMPRE ABAJO DEL FORMULARIO)
      //  Se deja dentro de este bloque, justo despuÃ©s de los campos de ediciÃ³n.
      .formulario-paciente(style='margin-top: 20px;')
        .form-group
          label(for='nombre') Nombre:
          input(
            type='text',
            id='nombre',
            name='nombre',
            required,
            placeholder='Nombre del paciente',
            value= pacienteEdit.nombre
          )
        .form-group
          label(for='cedula') CÃ©dula:
          input(
            type='text',
            id='cedula',
            name='cedula',
            required,
            placeholder='CÃ©dula del paciente',
            value= pacienteEdit.cedula
          )
        .form-group
          label(for='telefono') TelÃ©fono:
          input(
            type='text',
            id='telefono',
            name='telefono',
            required,
            placeholder='TelÃ©fono del paciente',
            value= pacienteEdit.telefono
          )
        .form-group
          label(for='direccion') DirecciÃ³n:
          input(
            type='text',
            id='direccion',
            name='direccion',
            required,
            placeholder='DirecciÃ³n del paciente',
            value= pacienteEdit.direccion
          )

        button(
          type='submit',
          style='background-color: #6c9eff; color: white; padding: 10px 0; width: 80%; border: none; border-radius: 8px; margin-top: 15px; font-size: 16px; font-weight: bold; cursor: pointer; display: block; margin-left: auto; margin-right: auto;'
        ) Actualizar Paciente

        //- Enlace â€œâ† Cancelar ediciÃ³nâ€ justo debajo del botÃ³n
        .text-center.mt-3
          a(
            href=`/pacientes?search=${search || ''}&page=${currentPage || 1}`,
            style='color: #dc3545; font-size: 14px; text-decoration: none;'
          ) â† Cancelar ediciÃ³n
        .text-center.mt-4 

      //- PÃ¡rrafo explicativo final, centrado
      .text-center.mt-4
        p.text-muted AquÃ­ puedes modificar los datos del paciente seleccionado.
      .text-center.mt-4

    else
      h2.text-center.mt-5 Registrar Paciente

      .formulario-paciente(style='margin-top: 20px;')
        .form-group
          label(for='nombre-crear') Nombre:
          input(
            type='text',
            id='nombre-crear',
            name='nombre',
            required,
            placeholder='Nombre del paciente'
          )
        .form-group
          label(for='cedula-crear') CÃ©dula:
          input(
            type='text',
            id='cedula-crear',
            name='cedula',
            required,
            placeholder='CÃ©dula del paciente'
          )
        .form-group
          label(for='telefono-crear') TelÃ©fono:
          input(
            type='text',
            id='telefono-crear',
            name='telefono',
            required,
            placeholder='TelÃ©fono del paciente'
          )
        .form-group
          label(for='direccion-crear') DirecciÃ³n:
          input(
            type='text',
            id='direccion-crear',
            name='direccion',
            required,
            placeholder='DirecciÃ³n del paciente'
          )

        button(
          type='submit',
          style='background-color: #6c9eff; color: white; padding: 10px 0; width: 80%; border: none; border-radius: 8px; margin-top: 15px; font-size: 16px; font-weight: bold; cursor: pointer; display: block; margin-left: auto; margin-right: auto;'
        ) Registrar Paciente

      //- PÃ¡rrafo explicativo final, centrado
      .text-center.mt-4
        p.text-muted Completa el formulario para aÃ±adir un nuevo paciente.
    .text-center.mt-4